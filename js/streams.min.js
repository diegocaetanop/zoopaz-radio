function toggleMusicOn(a){0<$(".m3uplayer").length&&a==$("#theurl").data("url")?0<$(".jp-playlist ul li").length&&("Play"==$("#playbutton").html()?($(".jp-play").click(),$("#playbutton").html("Pause")):($(".jp-pause").click(),$("#playbutton").html("Play"))):createPlaylistJs(a)}
function createPlaylistJs(a){isRadioMode=!1;displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=createPlaylistJs&dir="+encodeURIComponent(a),success:function(a){var b=$("#content").width();$("#content-player").html(a);isMobile&&isMobile()&&($("#musicindex").remove(),$("#playercontrols").remove(),a=b-16,$("#mediaplayer_wrapper").css("width",a+"px"));hideWorking()}})}
function openMyRadio(){location.hash="#/myradio";displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=openMyRadio",success:function(a){handleLogoutHtml(a);var c=$("#playercontrols");0<c.size()&&c.remove();$("#musicindex").replaceWith(a);hideWorking()}})}
function openDir(a){location.hash="#/open/"+encodeURIComponent(a);displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=openDir&url="+encodeURIComponent(a)+"&dir="+encodeURIComponent(a),success:function(a){handleLogoutHtml(a);/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?JSON.parse(a).is_logged_in&&$("#content").html(a):$("#content").html(a);hideWorking()}})}
function init(){var a=window.location.hash,a=a.replace(/^#/,""),a=a.split("/");switch(a[1]){case "open":a=decodeURIComponent(a[2]);openDir(a);break;case "myradio":openDir("/"),openMyRadio()}}function search(a){if(3>a.length)return getHomeIndex();0<$("#playbutton").length&&$("#playbutton").parent().remove();displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=search&q="+encodeURIComponent(a),success:function(a){handleLogoutHtml(a);$("#musicindex").html(a);hideWorking()}})}
function getHomeIndex(){displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=getHomeIndex",success:function(a){handleLogoutHtml(a);$("#navlist").html(a);$("#musicindex").html(a);hideWorking()}})}function displayWorkingMsg(){}function displayWorking(){$("#loading").css("display","block").css("visibility","visible")}function hideWorking(){$("#loading").css("display","none").css("visibility","hidden")}
function clearPlaylist(){$.getJSON("ajax.php?action=clearPlaylist",function(){myPlaylist.remove()})}
function addToPlaylist(a,c){var b=a||window.event;displayWorking();var d=$(c).data("type"),e="";"dir"==d?e="addToPlaylist":"file"==d&&(e="addToPlaylistFile");$.getJSON("ajax.php?action="+e+"&dir="+encodeURIComponent($(c).data("dir"))+"&file="+encodeURIComponent($(c).data("file")),function(a){handleLogoutJson(a);$(a).each(function(a,c){myPlaylist.add(c)});$(".album-title").text("Custom playlist");hideWorking()});b.stopPropagation();b.stopImmediatePropagation();b.cancelBubble=!0;return!1}
function logout(){displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=logout",success:function(){hideWorking();location.href="index.php"}})}function isJson(a){return!a.match(/^\s*{/)||!a.match(/^\s*\[/)||a.match(/^\s*$/)?!1:!0}function handleLogoutHtml(a){if(!isJson(a))return!1;a=JSON.parse(a);handleLogoutJson(a)}function handleLogoutJson(a){if(void 0===a.is_logged_in)return!1;a.is_logged_in||logout()}
function playRadio(){isRadioMode=!0;displayWorking();var a=new StreamsConfig;$.ajax({type:"GET",url:"ajax.php",data:"action=playRadio&num="+a.numberOfRadioItems,success:function(a){handleLogoutHtml(a);var b=$("#content").width();$("#content-player").html(a);$(".album-title").text("Radio");$("#playbutton").remove();isMobile&&isMobile()&&($("#musicindex"),$("#playercontrols").remove(),a=b-16,$("#mediaplayer_wrapper").css("width",a+"px"),a=$("#mediaplayer").offset().top,window.scrollTo(0,a));$("#mediaplayer").bind($.jPlayer.event.play,
function(){console.log("bind: Playlist size: "+myPlaylist.playlist.length+", Current position: "+myPlaylist.current)}).bind($.jPlayer.event.ended,function(){myPlaylist.remove(myPlaylist.current-1);$.getJSON("ajax.php?action=getRandomPlaylist&num=1",function(a){$(a).each(function(a,c){myPlaylist.add(c)})})});hideWorking()}})}
function playMyRadio(){isRadioMode=!0;displayWorking();var a=new StreamsConfig;$.getJSON("ajax.php?action=startPersonalRadio&num="+a.numberOfRadioItems,function(a){handleLogoutJson(a);var b=$("#content").width();$("#content-player").html(a.contentPlayer);$(".album-title").text("My Radio");$("#playbutton").remove();isMobile&&isMobile()&&($("#musicindex"),$("#playercontrols").remove(),a=b-16,$("#mediaplayer_wrapper").css("width",a+"px"),a=$("#mediaplayer").offset().top,window.scrollTo(0,a));$("#mediaplayer").bind($.jPlayer.event.play,
function(){console.log("bind: Playlist size: "+myPlaylist.playlist.length+", Current position: "+myPlaylist.current)}).bind($.jPlayer.event.ended,function(){myPlaylist.remove(myPlaylist.current-1);$.getJSON("ajax.php?action=getRandomPlaylist&num=1&personal=yes",function(a){$(a).each(function(a,b){myPlaylist.add(b)})})});hideWorking()})}
function createPersonalRadio(a,c){var b=a||window.event;isRadioMode=!0;displayWorking();var d=$(c).data("dir"),e=new StreamsConfig;$.getJSON("ajax.php?action=createPersonalRadio&dir="+encodeURIComponent(d)+"&num="+e.numberOfRadioItems,function(a){handleLogoutJson(a);var b=$("#content").width();$("#content-player").html(a.contentPlayer);$(".album-title").text("Radio "+d);$("#playbutton").remove();isMobile&&isMobile()&&($("#musicindex"),$("#playercontrols").remove(),a=b-16,$("#mediaplayer_wrapper").css("width",
a+"px"),a=$("#mediaplayer").offset().top,window.scrollTo(0,a));$("#mediaplayer").bind($.jPlayer.event.play,function(){console.log("bind: Playlist size: "+myPlaylist.playlist.length+", Current position: "+myPlaylist.current)}).bind($.jPlayer.event.ended,function(){myPlaylist.remove(myPlaylist.current-1);$.getJSON("ajax.php?action=getRandomPlaylist&num=1&personal=yes",function(a){$(a).each(function(a,b){myPlaylist.add(b)})})});hideWorking()});b.stopPropagation();b.stopImmediatePropagation();b.cancelBubble=
!0;return!1}function addToPersonalRadio(a,c){var b=a||window.event;displayWorking();var d=$(c).data("dir");$.getJSON("ajax.php?action=addToPersonalRadio&dir="+encodeURIComponent(d),function(a){handleLogoutJson(a);hideWorking()});b.stopPropagation();b.stopImmediatePropagation();b.cancelBubble=!0;return!1}pt=null;
function playTimeout(){clearTimeout(pt);$(".jp-pause").click();$("#playbutton").html("Play");confirm("Are you still listening?")&&($(".jp-play").click(),$("#playbutton").html("Pause"),setPlayTimeout());return!1}function setPlayTimeout(){var a=new StreamsConfig;if(!a.usePlayTimeout)return!1;pt=setTimeout("playTimeout()",1E3*parseInt(a.playTimeout))}isRadioMode=!1;
$(document).ready(function(){init();0<$("#content-player").length&&0<$(".m3uplayer").length&&$("#playbutton").html("Pause");$(document).on("click","#playbutton",function(){toggleMusicOn($(this).data("url"))});$(document).on("click",".jp-play",function(){$("#playbutton").html("Pause")});$(document).on("click",".jp-pause,.jp-stop",function(){$("#playbutton").html("Play")});$(document).on("click",".droplink",function(){openDir($(this).data("url"))});$(document).on("click",".dirlink",function(){openDir($(this).data("url"))});
$(document).on("click",".dirlinkcover",function(){openDir($(this).data("url"))});$(document).on("click",".addtoplaylist",function(a){addToPlaylist(a,this)});$(document).on("click",".jp-clear-playlist",function(a){clearPlaylist(a,this)});$(document).on("click","#logout-link",function(){logout(this)});$(document).on("click","#my-radio-button",function(){openMyRadio()});$(document).on("click","#play-my-radio",function(a){playMyRadio(a)});$(document).on("click","#radio-button",function(a){playRadio(a)});
$(document).on("click",".createradiobutton",function(a){createPersonalRadio(a,this)});$(document).on("click",".addtoradiobutton",function(a){addToPersonalRadio(a,this)});prevtime=parseInt((new Date).getTime());curval="";t=null;$(document).on("keyup","#search",function(){var a=new StreamsConfig;curval=$(this).val();curtime=parseInt((new Date).getTime());next=prevtime+a.searchThreshold;prevtime=curtime;curtime<next&&(clearTimeout(t),t=setTimeout("search('"+curval+"')",a.searchThreshold))});$(".playlist-albumart").livequery(function(){var a=
$(this);a.data("done")||$.getJSON("ajax.php?action=getAlbumArt&dir="+encodeURIComponent(a.data("dir"))+"&file="+encodeURIComponent(a.data("file")),function(c){a.attr("src",c.albumart);a.data("done",!0).css("width","2em").css("height","2em")})})});
